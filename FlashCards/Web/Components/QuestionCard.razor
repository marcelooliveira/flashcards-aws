<div class="mdc-card question-card mb">
    <div class="mdc-typography--headline6 mb">@Question.Text</div>
    <ul>
        @for (int i = 0; i < Question.QuestionOptions.Count; i++)
        {
            var opt = Question.QuestionOptions[i];
            bool isCorrect = Question.CorrectOptions.Contains(i);
            opt.Index = i;
            opt.IsCorrect = isCorrect;
            <QuestionOptionCard QuestionOption="@opt" IsLocked="@Question.IsLocked" OnCheckedChanged="OnOptionCheckedChanged" />
        }
    </ul>
    @if (Question.IsLocked)
    {
        <div class="mdc-typography--subtitle2">
            <b>Resposta correta:</b>
            <span class="answer-right">@string.Join(", ", Question.CorrectOptions.Select(i => (char)('A' + i)))</span>
        </div>
    }
</div>

@code {
    [Parameter]
    public Question Question { get; set; }

    [Parameter]
    public EventCallback<Question> OnAnswered { get; set; }

    void OnOptionCheckedChanged(QuestionOption qo)
    {
        Question.SelectedOptions.Remove(qo.Index);

        if (qo.IsSelected)
        {
            Question.SelectedOptions.Add(qo.Index);
        }
        Question.WasCorrect = Question.CorrectOptions.Contains(qo.Index)
                                && Question.SelectedOptions.Count() == Question.CorrectOptions.Count();
        OnAnswered.InvokeAsync(Question);
        StateHasChanged();
    }
}
